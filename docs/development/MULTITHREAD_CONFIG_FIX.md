# IWMS å¤šçº¿ç¨‹é…ç½®ä¿®å¤è¯´æ˜

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆåœ¨ç³»ç»Ÿè®¾ç½®é¡µé¢ä¸­è®¾ç½®çš„å¤šçº¿ç¨‹æ•°é‡æ— æ³•æ­£ç¡®ç”Ÿæ•ˆã€‚å…·ä½“è¡¨ç°ä¸ºï¼š
- åœ¨è®¾ç½®é¡µé¢è®¾ç½®çº¿ç¨‹æ•°ä¸º6
- ä½†é‡å‘½åä»»åŠ¡ç»“æŸåæ˜¾ç¤ºä½¿ç”¨äº†8ä¸ªçº¿ç¨‹
- è®¾ç½®æ— æ³•æ­£ç¡®ä¼ é€’åˆ°å›¾ç‰‡å‹ç¼©å¤„ç†æµç¨‹

## ğŸ” é—®é¢˜åˆ†æ

ç»è¿‡ä»£ç åˆ†æï¼Œå‘ç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯**é…ç½®ç®¡ç†å™¨å’Œè®¾ç½®ç®¡ç†å™¨ä½¿ç”¨äº†ä¸åŒçš„è®¾ç½®æ–‡ä»¶è·¯å¾„**ï¼š

### 1. è·¯å¾„ä¸ä¸€è‡´é—®é¢˜

**é…ç½®ç®¡ç†å™¨** (`configManager.js`) ä½¿ç”¨ï¼š
```javascript
// ä¼ ç»Ÿç³»ç»Ÿè·¯å¾„
~/Library/Application Support/IWMS/settings.json (macOS)
```

**ä¸»è¿›ç¨‹** (`main.js`) ä½¿ç”¨ï¼š
```javascript
// Electronæ ‡å‡†è·¯å¾„
app.getPath('userData')/settings.json
```

### 2. é…ç½®ä¼ é€’é“¾è·¯æ–­è£‚

```
è®¾ç½®é¡µé¢ â†’ ä¿å­˜è®¾ç½® â†’ main.js â†’ settings.json (Electronè·¯å¾„)
                                    â†“
å›¾ç‰‡å‹ç¼© â†’ configManager â†’ settings.json (ä¼ ç»Ÿè·¯å¾„) âŒ
```

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ç»Ÿä¸€è®¾ç½®æ–‡ä»¶è·¯å¾„

ä¿®æ”¹ `configManager.js` å’Œ `settingsManager.js`ï¼Œä½¿å…¶ä¼˜å…ˆä½¿ç”¨Electronæ ‡å‡†çš„ `userData` è·¯å¾„ï¼š

```javascript
// è·å–è®¾ç½®æ–‡ä»¶è·¯å¾„
function getSettingsPath() {
  // ä½¿ç”¨Electronæ ‡å‡†çš„userDataè·¯å¾„ï¼Œä¸main.jsä¿æŒä¸€è‡´
  try {
    const { app } = require('electron')
    if (app && app.getPath) {
      return path.join(app.getPath('userData'), 'settings.json')
    }
  } catch (error) {
    console.log('âš ï¸ æ— æ³•è·å–Electron userDataè·¯å¾„ï¼Œä½¿ç”¨å¤‡ç”¨è·¯å¾„')
  }
  
  // å¤‡ç”¨è·¯å¾„ï¼šä½¿ç”¨ä¼ ç»Ÿçš„ç³»ç»Ÿè·¯å¾„
  // ... ä¼ ç»Ÿè·¯å¾„é€»è¾‘
}
```

### 2. ä¿®å¤é…ç½®ä¼ é€’é“¾è·¯

åœ¨é‡å‘½åæœåŠ¡ä¸­æ­£ç¡®ä¼ é€’çº¿ç¨‹é…ç½®å‚æ•°ï¼š

```javascript
// ä¿®å¤å‰ï¼šç¡¬ç¼–ç å‚æ•°
const compressionResult = await compressImagesBatch({
  imageTasks: batch,
  maxFileSize: maxFileSize,
  useMultiThread: true  // âŒ ç¡¬ç¼–ç 
})

// ä¿®å¤åï¼šä½¿ç”¨é…ç½®ç®¡ç†å™¨
const compressionResult = await compressImagesBatch({
  imageTasks: batch,
  maxFileSize: maxFileSize,
  useMultiThread: config.imageProcessing.enableMultiThread,  // âœ… åŠ¨æ€é…ç½®
  maxThreads: config.imageProcessing.maxThreads              // âœ… åŠ¨æ€é…ç½®
})
```

### 3. å¢å¼ºå›¾ç‰‡å‹ç¼©å™¨

ä¿®æ”¹å›¾ç‰‡å‹ç¼©å™¨å‡½æ•°ç­¾åï¼Œæ”¯æŒæ¥æ”¶çº¿ç¨‹é…ç½®å‚æ•°ï¼š

```javascript
async function compressImagesBatch({ 
  imageTasks, 
  maxFileSize, 
  useMultiThread = true, 
  maxThreads = null  // âœ… æ–°å¢å‚æ•°
}) {
  // ä¼˜å…ˆä½¿ç”¨ä¼ é€’çš„å‚æ•°ï¼Œå…¶æ¬¡ä½¿ç”¨é…ç½®ç®¡ç†å™¨çš„è®¾ç½®
  const config = configManager.getCurrentConfig()
  const effectiveMaxThreads = maxThreads || config.imageProcessing.maxThreads
  const numThreads = Math.min(numCPUs, imageTasks.length, effectiveMaxThreads)
  
  console.log(`ğŸ§µ å¤šçº¿ç¨‹å‹ç¼©é…ç½®: CPUæ ¸å¿ƒæ•°=${numCPUs}, ä»»åŠ¡æ•°=${imageTasks.length}, é…ç½®çº¿ç¨‹æ•°=${effectiveMaxThreads}, å®é™…ä½¿ç”¨=${numThreads}`)
  
  // ... å¤„ç†é€»è¾‘
}
```

## ğŸ”§ ä¿®å¤çš„æ–‡ä»¶

### 1. `frontend/electron/utils/configManager.js`
- ä¿®å¤è®¾ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¼˜å…ˆä½¿ç”¨Electronæ ‡å‡†è·¯å¾„
- ä¿æŒå‘åå…¼å®¹æ€§ï¼Œæä¾›å¤‡ç”¨è·¯å¾„

### 2. `frontend/electron/utils/settingsManager.js`
- ç»Ÿä¸€è®¾ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¸ä¸»è¿›ç¨‹ä¿æŒä¸€è‡´
- ç¡®ä¿è®¾ç½®ä¿å­˜å’Œè¯»å–ä½¿ç”¨ç›¸åŒè·¯å¾„

### 3. `frontend/electron/services/renameService.js`
- ä¿®å¤å›¾ç‰‡å‹ç¼©å‡½æ•°è°ƒç”¨ï¼Œä¼ é€’æ­£ç¡®çš„çº¿ç¨‹é…ç½®
- ä½¿ç”¨é…ç½®ç®¡ç†å™¨åŠ¨æ€è·å–è®¾ç½®

### 4. `frontend/electron/utils/imageCompressor.js`
- å¢å¼ºå‡½æ•°ç­¾åï¼Œæ”¯æŒçº¿ç¨‹é…ç½®å‚æ•°
- ä¼˜åŒ–çº¿ç¨‹æ•°é‡è®¡ç®—é€»è¾‘
- æ·»åŠ è¯¦ç»†çš„é…ç½®æ—¥å¿—

## ğŸ“Š ä¿®å¤éªŒè¯

### 1. æµ‹è¯•è„šæœ¬
åˆ›å»ºäº† `frontend/scripts/test-config-manager.js` æµ‹è¯•è„šæœ¬ï¼ŒéªŒè¯ï¼š
- é…ç½®ç®¡ç†å™¨è·¯å¾„æ˜¯å¦æ­£ç¡®
- è®¾ç½®æ–‡ä»¶æ˜¯å¦èƒ½æ­£ç¡®è¯»å–
- é…ç½®å€¼æ˜¯å¦æ­£ç¡®ä¼ é€’

### 2. æµ‹è¯•ç»“æœ
```
ğŸ§ª æµ‹è¯•é…ç½®ç®¡ç†å™¨...

ğŸ”§ å½“å‰é…ç½®:
æœ€å¤§çº¿ç¨‹æ•°: 8
æ‰¹æ¬¡å¤§å°: 15
å¯ç”¨å¤šçº¿ç¨‹: true

ğŸ“ æµ‹è¯•è®¾ç½®ç®¡ç†å™¨...
è®¾ç½®æ–‡ä»¶è·¯å¾„: /Users/bbk/Library/Application Support/IWMS/settings.json
âœ… è®¾ç½®æ–‡ä»¶å­˜åœ¨
å½“å‰è®¾ç½®: {
  maxThreads: 8,
  batchSize: 15,
  useMultiThread: true,
  // ... å…¶ä»–è®¾ç½®
}
```

## ğŸ¯ ä¿®å¤æ•ˆæœ

### 1. è®¾ç½®åŒæ­¥
- âœ… è®¾ç½®é¡µé¢ä¿å­˜çš„é…ç½®èƒ½å¤Ÿè¢«é…ç½®ç®¡ç†å™¨æ­£ç¡®è¯»å–
- âœ… å¤šçº¿ç¨‹æ•°é‡è®¾ç½®èƒ½å¤Ÿæ­£ç¡®ä¼ é€’åˆ°å›¾ç‰‡å‹ç¼©æµç¨‹
- âœ… ç»Ÿä¸€äº†è®¾ç½®æ–‡ä»¶è·¯å¾„ï¼Œé¿å…é…ç½®ä¸ä¸€è‡´

### 2. åŠŸèƒ½å¢å¼º
- âœ… æ”¯æŒåŠ¨æ€çº¿ç¨‹é…ç½®ï¼Œä¸å†ç¡¬ç¼–ç 
- âœ… æ·»åŠ è¯¦ç»†çš„é…ç½®æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- âœ… ä¿æŒå‘åå…¼å®¹æ€§ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

### 3. ç”¨æˆ·ä½“éªŒ
- âœ… ç”¨æˆ·è®¾ç½®èƒ½å¤Ÿç«‹å³ç”Ÿæ•ˆ
- âœ… çº¿ç¨‹æ•°é‡é™åˆ¶èƒ½å¤Ÿæ­£ç¡®åº”ç”¨
- âœ… ç³»ç»Ÿè¡Œä¸ºæ›´åŠ å¯é¢„æµ‹

## ğŸš€ ä½¿ç”¨å»ºè®®

### 1. çº¿ç¨‹æ•°é…ç½®å»ºè®®
- **å†…å­˜ < 8GB**ï¼šé€‰æ‹©2ä¸ªçº¿ç¨‹
- **å†…å­˜ 8-16GB**ï¼šé€‰æ‹©4-6ä¸ªçº¿ç¨‹  
- **å†…å­˜ > 16GB**ï¼šé€‰æ‹©6-8ä¸ªçº¿ç¨‹

### 2. æ€§èƒ½ä¼˜åŒ–
- æ ¹æ®ç³»ç»Ÿæ€§èƒ½è°ƒæ•´çº¿ç¨‹æ•°
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- ä½¿ç”¨åˆ†æ‰¹å¤„ç†é¿å…å†…å­˜æº¢å‡º

### 3. æ•…éšœæ’é™¤
- æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ä¸­çš„çº¿ç¨‹é…ç½®ä¿¡æ¯
- éªŒè¯è®¾ç½®æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯é…ç½®è¯»å–

## ğŸ“ æ€»ç»“

é€šè¿‡ä¿®å¤è®¾ç½®æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´å’Œé…ç½®ä¼ é€’é“¾è·¯æ–­è£‚çš„é—®é¢˜ï¼ŒIWMSçš„å¤šçº¿ç¨‹é…ç½®ç°åœ¨èƒ½å¤Ÿæ­£ç¡®ç”Ÿæ•ˆã€‚ç”¨æˆ·å¯ä»¥åœ¨è®¾ç½®é¡µé¢ä¸­é…ç½®çº¿ç¨‹æ•°é‡ï¼Œè¿™äº›è®¾ç½®ä¼šç«‹å³åº”ç”¨åˆ°å›¾ç‰‡å‹ç¼©å¤„ç†æµç¨‹ä¸­ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

ä¿®å¤åçš„ç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
- **é…ç½®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰ç»„ä»¶ä½¿ç”¨ç›¸åŒçš„è®¾ç½®æ–‡ä»¶
- **åŠ¨æ€é…ç½®**ï¼šæ”¯æŒè¿è¡Œæ—¶è°ƒæ•´çº¿ç¨‹å‚æ•°
- **è¯¦ç»†æ—¥å¿—**ï¼šä¾¿äºè°ƒè¯•å’Œæ€§èƒ½ç›‘æ§
- **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½å’Œé…ç½®

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2024å¹´12æœˆ
**ä¿®å¤ç‰ˆæœ¬**: IWMS v1.0.0+
**å½±å“èŒƒå›´**: å¤šçº¿ç¨‹é…ç½®ã€å›¾ç‰‡å‹ç¼©ã€æ‰¹é‡é‡å‘½å
