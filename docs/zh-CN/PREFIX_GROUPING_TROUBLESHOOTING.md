# 按前缀分文件夹功能故障排除指南

## 问题描述
用户反馈：点击开始整理后按前缀分文件夹并没有工作，也没有生成移动日志。

## 解决方案

### 1. 检查配置选项
确保在文件整理界面中正确配置了以下选项：

- ✅ **按前缀分文件夹**: 必须勾选此选项
- ✅ **递归模式**: 根据需要选择
- ✅ **冲突处理策略**: 建议选择"跳过已存在文件"
- ✅ **清洗目录名**: 建议勾选
- ✅ **前缀大小写敏感**: 根据需要选择
- ✅ **生成移动日志**: 建议勾选

### 2. 验证功能是否正常工作

#### 方法1: 使用测试脚本
```bash
cd frontend
node scripts/test-real-scenario.js
```

#### 方法2: 检查控制台日志
1. 打开开发者工具 (F12)
2. 查看控制台输出
3. 寻找以下调试信息：
   - "开始执行文件整理，配置参数:"
   - "开始执行按前缀分文件夹..."
   - "文件整理结果:"

### 3. 常见问题排查

#### 问题1: 配置参数未正确传递
**症状**: 控制台显示 `groupByPrefix: false`
**解决**: 确保在界面上勾选了"按前缀分文件夹"选项

#### 问题2: 文件重命名失败
**症状**: 重命名失败，导致前缀分组无法执行
**解决**: 
- 检查文件权限
- 确保文件未被其他程序占用
- 检查磁盘空间

#### 问题3: 没有符合条件的文件
**症状**: 没有文件被处理
**解决**: 
- 确保文件扩展名在支持列表中：`.jpg`, `.jpeg`, `.png`, `.heic`, `.tif`, `.tiff`, `.gif`
- 确保文件名格式符合要求

#### 问题4: 移动日志未生成
**症状**: 没有生成 `move_log.csv` 文件
**解决**:
- 确保勾选了"生成移动日志"选项
- 检查目录写入权限
- 查看控制台错误信息

### 4. 调试步骤

#### 步骤1: 检查配置
```javascript
// 在浏览器控制台中运行
console.log('organizeConfig:', organizeConfig)
```

#### 步骤2: 检查文件列表
```javascript
// 在浏览器控制台中运行
console.log('fileList:', fileList.value)
```

#### 步骤3: 检查结果
```javascript
// 在浏览器控制台中运行
console.log('result:', result)
```

### 5. 预期结果

#### 成功执行后应该看到：
1. **控制台输出**:
   ```
   开始执行文件整理，配置参数: { groupByPrefix: true, ... }
   开始执行按前缀分文件夹...
   重命名后的文件数量: X
   移动日志已保存到: /path/to/move_log.csv
   ```

2. **成功消息**:
   ```
   文件整理完成！
   - 成功重命名：X 个文件
   - 处理组数：X 个
   - 失败文件：X 个

   按前缀分文件夹结果：
   - 成功移动：X 个文件
   - 跳过文件：X 个
   - 失败文件：X 个
   - 创建文件夹：X 个
   ```

3. **文件系统变化**:
   - 创建了以前缀命名的文件夹
   - 文件被移动到对应文件夹
   - 生成了 `move_log.csv` 文件

### 6. 测试用例

#### 测试文件示例：
```
A-1.JPG
A-1 (1).JPG
A-1 (2).JPG
B-3 (1).JPG
B-3 (2).JPG
```

#### 预期输出：
```
/A-1/
  A-1.JPG
  A-1 (1).JPG
  A-1 (2).JPG
/B-3/
  B-3 (1).JPG
  B-3 (2).JPG
move_log.csv
```

### 7. 联系支持

如果问题仍然存在，请提供以下信息：

1. **错误截图**: 界面和错误消息
2. **控制台日志**: 开发者工具中的错误信息
3. **文件列表**: 要处理的文件名称
4. **配置截图**: 文件整理配置选项
5. **系统信息**: 操作系统版本、IWMS版本

### 8. 相关文件

- **前端组件**: `frontend/src/views/FileOrganize.vue`
- **核心逻辑**: `frontend/electron/utils/prefixGrouper.js`
- **文件整理器**: `frontend/electron/utils/fileOrganizer.js`
- **测试脚本**: `frontend/scripts/test-real-scenario.js`
- **功能文档**: `docs/zh-CN/PREFIX_GROUPING_FEATURE.md`
