# 🚀 IWMS 功能指南

## 📋 概述

本文档涵盖了IWMS项目的所有核心功能，包括批量重命名、文件整理、文件操作等主要功能的使用说明。

## 🎯 批量重命名功能

### 功能概述

批量重命名是IWMS的核心功能，支持基于Excel映射表对文件进行智能批量重命名。

### 主要特性

#### 1. Excel映射表支持
- **格式支持**: 支持.xlsx、.xls、.csv格式
- **映射规则**: 第一列为原文件名，第二列为新文件名
- **智能解析**: 自动识别文件名的主名、编号、扩展名
- **错误检测**: 检测重复映射和格式错误

#### 2. 文件名智能识别
```javascript
// 文件名解析正则表达式
const FILE_NAME_REGEX = /^(.+?)\s*\((\d+)\)(\.[^.]+)$|^(.+?)(\.[^.]+)$/

// 解析结果
{
  base: 'filename',      // 主名
  idx: 1,               // 编号（可选）
  ext: '.jpg',          // 扩展名
  originalExt: '.JPG',  // 原始扩展名
  isMain: false         // 是否为主图
}
```

#### 3. 冲突处理策略
- **跳过**: 不处理冲突文件，记录到日志
- **覆盖**: 直接覆盖目标文件
- **追加后缀**: 自动添加 `_conflict-1`, `_conflict-2` 等后缀

### 使用流程

#### 步骤1: 选择输入文件夹
- 点击"选择文件夹"按钮
- 选择包含需要重命名文件的文件夹
- 可选择是否递归扫描子文件夹
- 选择文件类型（仅图片/所有文件）

#### 步骤2: 选择输出路径
- 选择处理后的文件输出位置
- 设置冲突处理策略
- 配置输出选项

#### 步骤3: 上传映射表
- 选择Excel文件
- 查看映射预览和错误提示
- 确认映射关系正确

#### 步骤4: 预览与执行
- 点击"预览变更"查看处理结果
- 确认无误后点击"执行重命名"
- 查看处理报告

### 批量重命名更新

#### 最新功能
- **智能文件名解析**: 更准确的文件名识别
- **批量处理优化**: 提升大量文件处理性能
- **预览功能增强**: 更详细的预览信息
- **错误处理完善**: 更友好的错误提示

## 📁 文件整理功能

### 功能概述

文件整理功能帮助用户对文件进行智能排序和重命名，特别适用于图片文件的整理。

### 整理模式

#### 1. 模式A（主图无序号）
- **主图**: 保持 `base.ext` 格式
- **从图**: 编号为 `base (n).ext` 格式
- **适用场景**: 照片整理，主图不编号

#### 2. 模式B（主图也编号）
- **所有文件**: 统一编号为 `base (n).ext` 格式
- **适用场景**: 需要统一编号的文件整理

### 整理规则

#### 1. 文件分组
- 按主名分组文件
- 识别主图和从图
- 智能排序编号

#### 2. 重命名逻辑
```javascript
// 整理重命名逻辑
const organizeFiles = (files, config) => {
  const groups = groupFilesByBase(files)
  
  return groups.map(group => {
    const mainFile = findMainFile(group)
    const subFiles = findSubFiles(group)
    
    return {
      mainFile: renameMainFile(mainFile, config),
      subFiles: renameSubFiles(subFiles, config)
    }
  })
}
```

### 使用示例

#### 输入文件
```
A-1.JPG
A-1 (1).JPG
A-1 (7).JPG
B-3 (2).JPG
B-3 (4).JPG
B-3 (5).JPG
```

#### 模式A输出
```
A-1.jpg (主图标准化)
A-1 (1).jpg (保持不变)
A-1 (3).jpg (重新编号)
B-3.jpg (提升为主图)
B-3 (1).jpg (重新编号)
B-3 (2).jpg (重新编号)
```

#### 模式B输出
```
A-1 (1).jpg (主图编号)
A-1 (2).jpg (重新编号)
A-1 (4).jpg (重新编号)
B-3 (1).jpg (重新编号)
B-3 (2).jpg (重新编号)
B-3 (3).jpg (重新编号)
```

## 🔧 文件操作功能

### 功能概述

文件操作功能提供高级的文件管理工具，支持批量移动、复制、删除等操作。

### 主要操作

#### 1. 批量移动
- **源文件夹**: 选择要移动的文件所在文件夹
- **目标文件夹**: 选择移动的目标位置
- **过滤条件**: 按文件类型、大小等条件过滤
- **冲突处理**: 处理目标位置的文件冲突

#### 2. 批量复制
- **源文件夹**: 选择要复制的文件所在文件夹
- **目标文件夹**: 选择复制的目标位置
- **保持结构**: 是否保持原有的文件夹结构
- **进度显示**: 实时显示复制进度

#### 3. 批量删除
- **安全删除**: 支持回收站功能
- **预览删除**: 删除前预览要删除的文件
- **批量确认**: 批量确认删除操作
- **删除报告**: 生成删除操作报告

### 操作特性

#### 1. 智能过滤
- **文件类型过滤**: 按扩展名过滤文件
- **文件大小过滤**: 按文件大小范围过滤
- **日期过滤**: 按创建或修改日期过滤
- **名称过滤**: 按文件名模式过滤

#### 2. 批量处理
- **多线程处理**: 支持多线程并行处理
- **进度监控**: 实时显示处理进度
- **错误处理**: 完善的错误处理和恢复
- **结果报告**: 生成详细的操作报告

#### 3. 安全机制
- **预览功能**: 操作前预览结果
- **备份机制**: 重要操作前自动备份
- **撤销功能**: 支持操作撤销
- **日志记录**: 完整的操作日志

## 📊 导出报告功能

### 功能概述

导出报告功能生成详细的操作报告，帮助用户了解处理结果和统计数据。

### 报告内容

#### 1. 处理统计
- **总文件数**: 处理的文件总数
- **成功数量**: 成功处理的文件数量
- **失败数量**: 处理失败的文件数量
- **跳过数量**: 跳过的文件数量

#### 2. 详细记录
- **文件列表**: 每个文件的处理结果
- **错误信息**: 详细的错误描述
- **处理时间**: 每个文件的处理时间
- **文件大小**: 处理前后的文件大小

#### 3. 性能统计
- **处理速度**: 文件处理速度统计
- **内存使用**: 内存使用情况
- **CPU使用**: CPU使用情况
- **耗时分析**: 各阶段耗时分析

### 报告格式

#### 1. CSV格式
- **标准格式**: 兼容Excel的CSV格式
- **字段完整**: 包含所有必要信息
- **易于分析**: 便于数据分析和处理
- **多语言支持**: 支持中文和英文

#### 2. 报告模板
```csv
文件名,原路径,新路径,处理状态,错误信息,处理时间
A-1.jpg,/input/A-1.jpg,/output/A-1.jpg,成功,,2024-01-01 10:00:00
B-2.png,/input/B-2.png,/output/B-2.png,失败,文件不存在,2024-01-01 10:00:01
```

### 导出修复

#### 问题描述
- 导出报告功能存在数据丢失问题
- 报告格式不完整
- 导出速度较慢

#### 修复内容
- **数据完整性**: 确保所有数据正确导出
- **格式优化**: 优化报告格式和字段
- **性能提升**: 提升导出速度和效率
- **错误处理**: 完善导出错误处理

## 🔍 环境检测功能

### 功能概述

环境检测功能自动检测系统环境，确保IWMS能够正常运行。

### 检测项目

#### 1. 系统环境
- **操作系统**: 检测操作系统类型和版本
- **Node.js版本**: 检测Node.js版本兼容性
- **Electron版本**: 检测Electron版本
- **系统架构**: 检测系统架构（x64/arm64）

#### 2. 依赖检查
- **必要依赖**: 检查必要的系统依赖
- **可选依赖**: 检查可选的增强功能依赖
- **版本兼容**: 检查依赖版本兼容性
- **缺失依赖**: 提示缺失的依赖

#### 3. 权限检查
- **文件系统权限**: 检查文件读写权限
- **网络权限**: 检查网络访问权限
- **系统权限**: 检查系统级权限
- **安全限制**: 检查安全策略限制

### 检测结果

#### 1. 检测报告
```javascript
// 环境检测结果
{
  system: {
    platform: 'darwin',
    arch: 'arm64',
    version: '14.0.0'
  },
  nodejs: {
    version: '18.17.0',
    compatible: true
  },
  electron: {
    version: '27.0.0',
    compatible: true
  },
  permissions: {
    fileSystem: true,
    network: true
  },
  dependencies: {
    required: ['fs-extra', 'xlsx'],
    optional: ['sharp'],
    missing: []
  }
}
```

#### 2. 问题解决
- **自动修复**: 自动修复简单问题
- **手动指导**: 提供手动解决指导
- **依赖安装**: 自动安装缺失依赖
- **配置优化**: 优化系统配置

## 🔮 未来功能

### 计划中的功能
1. **云端同步**: 支持文件云端同步
2. **插件系统**: 支持自定义插件
3. **批量下载**: 支持批量文件下载
4. **格式转换**: 支持文件格式转换

### 功能优化
1. **性能提升**: 进一步提升处理性能
2. **界面优化**: 持续优化用户界面
3. **功能完善**: 完善现有功能
4. **兼容性**: 提升系统兼容性

## 📚 相关文档

- [快速启动指南](QUICK_START.md) - 快速上手IWMS
- [UI界面指南](UI_GUIDE.md) - 界面使用说明
- [设置指南](SETTINGS_GUIDE.md) - 系统设置说明
- [项目总结](PROJECT_SUMMARY.md) - 项目整体架构

---

**注意**: 本文档涵盖了IWMS的所有核心功能，如需了解具体实现细节，请参考相关源代码。
